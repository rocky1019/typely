<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard â€” Typely</title>
<link rel="stylesheet" href="style.css">
<style>
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-top: 16px;
  }
  .stat-card {
    text-align: center;
    padding: 16px;
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
  }
  .stat-card h3 {
    margin: 0;
    font-size: 14px;
    color: var(--muted);
  }
  .stat-card p {
    margin: 4px 0 0;
    font-size: 20px;
    font-weight: 700;
  }
  .actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }
  .recent-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .recent-list li {
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    font-size: 14px;
    color: var(--muted);
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>âš¡ Typely Dashboard</h1>
    <div class="controls">
      <button onclick="logout()">Logout</button>
    </div>
  </header>

  <main>
    <!-- Welcome -->
    <div class="card">
      <h2>Welcome, <span id="username">User</span> ðŸ‘‹</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Best WPM</h3>
          <p id="bestWPM">0</p>
        </div>
        <div class="stat-card">
          <h3>Accuracy</h3>
          <p id="bestAcc">0%</p>
        </div>
        <div class="stat-card">
          <h3>Streak</h3>
          <p id="streak">0</p>
        </div>
        <div class="stat-card">
          <h3>Sessions</h3>
          <p id="sessions">0</p>
        </div>
      </div>
      <div class="actions">
        <a href="room.html"><button class="primary">Start Practice</button></a>
        <a href="leaderboard.html"><button>Leaderboard</button></a>
      </div>
    </div>

    <!-- Recent Sessions -->
    <div class="card">
      <h3>Recent Sessions</h3>
      <ul class="recent-list" id="recentSessions">
        <li>Loading...</li>
      </ul>
    </div>
  </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = { 
  apiKey: "AIzaSyDWvTfK3JlGNampfkOb-tOQN6jMIcFHja0",
  authDomain: "focusly-typing.firebaseapp.com",
  projectId: "focusly-typing",
  storageBucket: "focusly-typing.firebasestorage.app",
  messagingSenderId: "641626023018",
  appId: "1:641626023018:web:c10016647bd32eb30c5613",
  measurementId: "G-RYEM86ZQSH"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.logout = () => signOut(auth);

onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location.href = "login.html"; return; }
  document.getElementById("username").textContent = user.displayName || "User";

  // Load leaderboard stats
  const lbDoc = await getDoc(doc(db, "leaderboard", user.uid));
  if (lbDoc.exists()) {
    const d = lbDoc.data();
    document.getElementById("bestWPM").textContent = d.bestWPM || 0;
    document.getElementById("bestAcc").textContent = d.bestAccuracy ? d.bestAccuracy + "%" : "0%";
  }

  // Load recent sessions
  const q = query(collection(db, "users", user.uid, "sessions"), orderBy("date", "desc"), limit(5));
  const snap = await getDocs(q);
  let html = "";
  let count = 0;
  snap.forEach(s => {
    const d = s.data();
    html += `<li>${d.lessonId} â€” ${d.wpm} WPM, ${d.accuracy}%</li>`;
    count++;
  });
  document.getElementById("recentSessions").innerHTML = html || "<li>No sessions yet</li>";
  document.getElementById("sessions").textContent = count;
});

</script>
</body>
</html>
